<section class="max-w-7xl mx-auto p-6">
  <div class="flex flex-col lg:flex-row min-h-screen text-black dark:text-white p-4 gap-4 text-base">
    
    <!-- Panel izquierdo -->
    <div class="flex-1 flex flex-col gap-4">
      
      <!-- Header placa -->
      <div class="rounded-xl p-4 text-center dark:bg-neutral-800 bg-neutral-100 border dark:border-neutral-700">
        <p class="text-lg">{{conductor?.nombres}} {{conductor?.apellidos}}</p>
        <h2 class="text-4xl font-bold tracking-widest">{{conductor?.placa_auto}}</h2>
        <div class="flex justify-center items-center mt-2">
          <span class="w-3.5 h-3.5 rounded-full bg-green-500"></span>
        </div>
      </div>

      <!-- Selector calendario -->
      <tui-textfield [content]="control.value?.daySame(today) ? 'Today' : ''">
        <label tuiLabel>Choose a date</label>
        <input tuiInputDate [formControl]="control" />
        <ng-template let-close tuiTextfieldDropdown>
          <tui-calendar />
          <button tuiButton appearance="action" size="m" type="button" (click)="control.setValue(today); close()">Hoy</button>
        </ng-template>
      </tui-textfield>

      <!-- Carrusel de fechas -->
      <div class="flex items-center justify-center gap-2">
        <button class="text-3xl" (click)="prevDates()">
          <tui-icon icon="@tui.chevron-left"></tui-icon>
        </button>

        <div class="flex gap-2 overflow-hidden w-[560px] relative">
          <div class="flex gap-2 transition-transform duration-500" [style.transform]="'translateX(-' + offset + 'px)'">
            <div *ngFor="let fecha of fechas"
                 class="px-4 py-2 rounded-md text-center min-w-[70px] cursor-pointer"
                 [ngClass]="{
                   'bg-blue-600 text-white font-bold': isSelected(fecha),
                   'dark:bg-neutral-800 bg-neutral-100 border dark:border-neutral-700': !isSelected(fecha)
                 }"
                 (click)="selectDate(fecha)">
              <p class="text-lg font-bold">{{ fecha.getDate() | number:'2.0' }}</p>
              <p class="text-sm uppercase">{{ fecha | date:'MMM' }}</p>
            </div>
          </div>
        </div>

        <button class="text-3xl" (click)="nextDates()">
          <tui-icon icon="@tui.chevron-right"></tui-icon>
        </button>
      </div>
      <!-- Acordeón de viajes -->
      <div>
        <h3 class="mb-2 font-semibold text-lg">{{ vueltas.length }} Viajes</h3>
        <div *ngFor="let vuelta of vueltas">
          <div class="dark:bg-neutral-800 bg-neutral-100 border dark:border-neutral-700 rounded-lg mb-4 cursor-pointer"
               (click)="toggle(vuelta)">
            <button class="w-full text-left px-4 py-3 text-lg flex justify-between items-center">
              {{ vuelta.titulo }}
              <tui-icon icon="@tui.chevron-down" [class.rotate-180]="vuelta.abierto"
                        class="transition-transform"></tui-icon>
            </button>
            <div class="transition-all duration-500 overflow-hidden"
                 [style.maxHeight]="vuelta.abierto ? '1000px' : '0'">
              <div class="divide-y divide-neutral-700 px-4 pb-4">
                <div *ngFor="let d of vuelta.detalles" class="flex flex-col sm:flex-row sm:justify-between py-2 gap-2">
                  <p class="text-lg">{{ d.tramo }}</p>
                  <div class="flex items-center gap-2">
                    <span class="font-mono text-lg">{{ d.hora }}</span>
                    <span class="w-3.5 h-3.5 rounded-full" [ngClass]="'bg-' + d.color + '-500'"></span>
                    <span class="font-mono text-lg" [ngClass]="'text-' + d.color + '-400'">{{ d.delta }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Panel derecho -->
    <div class="w-full lg:w-96 dark:bg-neutral-800 bg-neutral-100 border dark:border-neutral-700 rounded-xl p-4 flex flex-col gap-4 text-lg">
      <div class="text-left lg:text-right">
        <p class="text-lg">{{ selectedDate | date:'fullDate' }}</p>
      </div>

      <!-- Resumen gráfico -->
      <div>
        <h3 class="text-blue-400 font-semibold mb-2 text-xl">Resumen</h3>
        <div class="wrapper">
          <tui-ring-chart [value]="value" [(activeItemIndex)]="activeItemIndex">
            <span>{{ sum | tuiAmount: 'USD' | async }}</span>
            <div>Total</div>
          </tui-ring-chart>
          <div class="legend">
            <tui-legend-item *ngFor="let label of labels; let index = index" size="s"
                             [active]="isItemActive(index)"
                             [color]="'var(--tui-chart-categorical-0' + index + ')'"
                             [text]="label"
                             (tuiHoveredChange)="onHover(index, $event)">
              <span>{{ value[index] || 0 | tuiAmount: 'USD' | async }}</span>
            </tui-legend-item>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
